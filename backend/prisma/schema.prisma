generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model campaign {
  campaign_id       String              @id @db.VarChar(40)
  campaign_name     String?             @db.VarChar(100)
  city_filter       String?             @db.VarChar(50)
  gender_filter     gender_type
  scheduled_at      DateTime            @db.Timestamptz(6)
  sent_at           DateTime?           @db.Timestamptz(6)
  created_by        String              @db.VarChar(40)
  status            status_type
  staff             users               @relation(fields: [created_by], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
  notification_logs notification_logs[]
}

model notification_logs {
  user_id     String     @db.VarChar(40)
  campaign_id String     @db.VarChar(40)
  sent_at     DateTime?  @db.Timestamptz(6)
  status      log_status
  campaign    campaign   @relation(fields: [campaign_id], references: [campaign_id], onDelete: Cascade, onUpdate: NoAction)
  users       users      @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)

  @@id([user_id, campaign_id])
}

model preference {
  preference_id String  @id @db.VarChar(40)
  user_id       String? @unique @db.VarChar(40)
  offers        String  @default("OFF") @db.VarChar(50)
  order_updates String  @default("OFF") @db.VarChar(50)
  newsletter    String  @default("OFF") @db.VarChar(50)
  users         users?  @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
}

model users {
  user_id           String              @id @db.VarChar(40)
  name              String              @db.VarChar(100)
  email             String              @unique @db.VarChar(100)
  password          String              @db.VarChar(255)
  phone             String              @db.VarChar(10)
  city              String              @db.VarChar(50)
  gender            gender_type
  role              role_type           @default(CUSTOMER)
  is_active         Boolean?            @default(true)
  campaign          campaign[]
  notification_logs notification_logs[]
  orders            orders[]
  preference        preference?
}

model orders {
  order_id   String       @id @db.VarChar(40)
  product_id String       @db.VarChar(40)
  user_id    String       @db.VarChar(40)
  status     order_status @default(PROCESSING)
  product    product      @relation(fields: [product_id], references: [product_id], onDelete: Cascade, onUpdate: NoAction)
  users      users        @relation(fields: [user_id], references: [user_id], onDelete: Cascade, onUpdate: NoAction)
}

model product {
  product_id  String   @id @db.VarChar(40)
  name        String   @db.VarChar(50)
  description String   @db.VarChar(100)
  price       Int
  orders      orders[]
}

enum gender_type {
  MALE
  FEMALE
  NONE
}

enum log_status {
  SUCCESS
  FAILED
}

enum role_type {
  ADMIN
  CREATOR
  VIEWER
  CUSTOMER
}

enum status_type {
  DRAFT
  SCHEDULED
  SENT
}

enum order_status {
  PROCESSING
  SHIPPED
  DELIVERED
}
